@startuml class-diagram
' Configuration pour un affichage carrÃ© compact
skinparam packageStyle rectangle
skinparam classAttributeIconSize 0
skinparam shadowing false
skinparam defaultFontName Arial, Helvetica, sans-serif
skinparam dpi 200
skinparam linetype ortho
skinparam nodesep 60
skinparam ranksep 80
skinparam padding 8

' Couleurs pour une meilleure lisibilitÃ©
skinparam class {
    BackgroundColor<<config>> LightYellow
    BackgroundColor<<analyzer>> LightBlue
    BackgroundColor<<page>> LightGreen
    BackgroundColor<<cache>> LightCoral
    BorderColor Black
    ArrowColor DarkGray
}

title Architecture IADATA700 MangetaMain

package "ğŸ¯ APPLICATION" #TECHNOLOGY {
    class App {
        -config: AppConfig
        --
        +run(): void
    }
    
    class "AppConfig" as AppConfig <<config>> {
        +default_recipes_path: Path
        +default_interactions_path: Path
        +page_title: str
        +layout: str
    }
    
    App -right-> AppConfig : configure
}

package "ğŸ“¦ CORE (Logique MÃ©tier)" #BUSINESS {
    
    together {
        class DataLoader {
            -data_path: Path
            --
            +load_data(): DataFrame
            +get_data(): DataFrame
        }
        
        class DataExplorer {
            -loader: DataLoader
            --
            +df: DataFrame
        }
    }
    
    class "CacheManager" as CacheManager <<cache>> {
        -base_cache_dir: Path
        -logger: Logger
        --
        +get(): Optional[T]
        +set(): bool
        +clear(): int
        +get_info(): dict
    }
    
    abstract class "CacheableMixin" as CacheableMixin <<cache>> {
        {abstract}
        --
        +cached_operation(): T
        +enable_cache(): void
    }
    
    class "PreprocessingConfig" as PreprocessingConfig <<config>> {
        +enable_preprocessing: bool
        +outlier_method: str
        +outlier_threshold: float
        --
        +get_hash(): str
    }
    
    class "InteractionsAnalyzer" as InteractionsAnalyzer <<analyzer>> {
        +interactions: DataFrame
        +recipes: DataFrame
        +preprocessing: PreprocessingConfig
        --
        +aggregate(): DataFrame
        +popularity_vs_rating(): DataFrame
        +get_cache_info(): dict
    }
    
    ' Relations internes au package core
    DataExplorer --> DataLoader : utilise
    CacheableMixin --> CacheManager : utilise
    InteractionsAnalyzer -up-|> CacheableMixin : hÃ©rite
    InteractionsAnalyzer --> PreprocessingConfig : utilise
}

package "ğŸ–¥ï¸ COMPONENTS (Interface UI)" #APPLICATION {
    
    together {
        class "PopularityAnalysisPage\n(Page 1)" as PopularityAnalysisPage <<page>> {
            -interactions_analyzer: InteractionsAnalyzer
            -config, logger
            --
            +run(), render_sidebar()
            +_render_step_1_preprocessing()
            +_render_step_2_aggregation()
            +_render_step_3_scatter()
            +_render_step_4_characteristics()
        }
        
        class PopularityAnalysisConfig <<config>> {
            +interactions_path: Path
            +recipes_path: Path
        }
    }
    
    together {
        class "IngredientsClusteringPage\n(Page 2)" as IngredientsClusteringPage <<page>> {
            -matrix_path: Path
            -ingredients_list_path: Path
            -config, logger
            --
            +run(), render_sidebar()
            +_load_cooccurrence_matrix()
            +_perform_clustering()
            +_compute_tsne()
            --
            +render_cooccurrence_analysis()
            +render_clusters()
            +render_tsne_visualization()
        }
        
        class IngredientsClusteringConfig <<config>> {
            +matrix_path: Path
            +ingredients_list_path: Path
            +n_ingredients: int = 40
            +n_clusters: int = 4
            +tsne_perplexity: int = 30
        }
    }
    
    ' Relations internes composants
    PopularityAnalysisPage --> PopularityAnalysisConfig
    IngredientsClusteringPage --> IngredientsClusteringConfig
}

' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
' RELATIONS PRINCIPALES
' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

' Application vers Pages (utilisation)
App --> PopularityAnalysisPage : <<Page 1>>
App --> IngredientsClusteringPage : <<Page 2>>
App --> DataExplorer : <<Home>>

' Pages vers Analyseurs (composition forte)
PopularityAnalysisPage --> InteractionsAnalyzer : analyse

' Analyseurs vers DataLoader (dÃ©pendance)
InteractionsAnalyzer ..> DataLoader : charge

' Cache management
PopularityAnalysisPage ..> CacheManager : contrÃ´le

' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
' NOTES EXPLICATIVES
' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

note top of App
  **Application Streamlit Multi-Pages**
  â€¢ ğŸ  Home (exploration gÃ©nÃ©rale)
  â€¢ ğŸ”¥ Page 1: Analyse popularitÃ©
  â€¢ ğŸ³ Page 2: Clustering ingrÃ©dients
  --
  â€¢ Logger structurÃ©
  â€¢ Tests: 24 tests (Page 2)
end note

note bottom of CacheManager
  **Cache CentralisÃ©**
  â€¢ Structure: cache/analyzer/operation/hash.pkl
  â€¢ MÃ©tadonnÃ©es: timestamp, params
  â€¢ Support multi-analyseurs
  â€¢ Nettoyage granulaire
end note

note bottom of PopularityAnalysisPage
  **Page 1 - Structure 4 Ã‰tapes**
  â‘  Preprocessing outliers
  â‘¡ AgrÃ©gation par recette
  â‘¢ Scatter popularitÃ©/notes
  â‘£ Features vs popularitÃ©
  --
  â€¢ User Story dans UI
  â€¢ ContrÃ´les cache sidebar
end note

note bottom of IngredientsClusteringPage
  **Page 2 - Clustering IngrÃ©dients**
  â€¢ Matrice 300Ã—300 prÃ©calculÃ©e
  â€¢ SÃ©lection dynamique 40-300 ingrÃ©dients
  â€¢ Clustering K-means (3-20 clusters)
  â€¢ Visualisation t-SNE 2D
  --
  â€¢ Pas de preprocessing runtime
  â€¢ Cache Streamlit natif uniquement
end note

legend bottom right
  **LÃ©gende**
  <<config>> = Configuration (dataclass)
  <<analyzer>> = Analyseur mÃ©tier
  <<page>> = Page Streamlit
  <<cache>> = SystÃ¨me de cache
  --
  FlÃ¨ches:
  â†’ Relation forte (composition)
  â‡¢ Relation faible (dÃ©pendance)
  â”€â”€|> HÃ©ritage
endlegend

@enduml
